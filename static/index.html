<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情感分析系统</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- 添加训练CSS样式 -->
    <link rel="stylesheet" href="/static/css/training.css">
</head>
<body>
<!-- 顶部导航栏 -->
<nav class="navbar navbar-expand-lg navbar-dark top-navbar">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <i class="bi bi-graph-up"></i> 情感分析系统
        </a>

        <div class="navbar-text system-title d-none d-md-block">
            智能文本情感分析平台
        </div>

        <!-- 用户信息和操作 -->
        <div class="ms-auto user-navbar-panel">
            <div class="dropdown">
                <button class="btn btn-outline-light dropdown-toggle user-dropdown" type="button" id="userDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-person-circle"></i>
                    <span id="navbarUsername">加载中...</span>
                    <span id="navbarUserRole" class="badge bg-primary ms-1">用户</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="#" id="navbarProfile"><i class="bi bi-person"></i> 个人资料</a>
                    </li>
                    <li><a class="dropdown-item" href="#" id="navbarSettings"><i class="bi bi-gear"></i> 设置</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="#" id="navbarLogoutBtn"><i class="bi bi-box-arrow-right"></i> 注销</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<div class="app-container">
    <!-- 左侧边栏 - 恢复原来的结构 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>情感分析系统</h3>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item active" data-section="input-section">
                <i class="bi bi-input-cursor-text"></i>
                <span>文本输入</span>
            </div>
            <div class="menu-item" data-section="overall-section">
                <i class="bi bi-pie-chart"></i>
                <span>整体分析</span>
            </div>
            <div class="menu-item" data-section="sentences-section">
                <i class="bi bi-list-ul"></i>
                <span>句子分析</span>
            </div>
            <div class="menu-item" data-section="word-freq-section">
                <i class="bi bi-cloud"></i>
                <span>词频统计</span>
            </div>
            <!-- 将模型训练改为所有用户可访问 (移除 admin-only 类) -->
            <div class="menu-item" data-section="training-section">
                <i class="bi bi-gpu-card"></i>
                <span>模型训练</span>
            </div>
            <!-- 管理员专用菜单项 -->
            <div class="menu-item admin-only" data-section="admin-section">
                <i class="bi bi-gear-fill"></i>
                <span>系统管理</span>
            </div>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="main-content">
        <!-- 输入区域 -->
        <div class="content-section active" id="input-section">
            <div class="section-header">
                <h4>文本输入</h4>
            </div>
            <div class="section-body">
                <div class="input-section">
                    <ul class="nav nav-tabs mb-3" id="inputTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="text-tab" data-bs-toggle="tab"
                                    data-bs-target="#textInput-tab"
                                    type="button" role="tab" aria-controls="textInput-tab" aria-selected="true">文本输入
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#fileInput-tab"
                                    type="button" role="tab" aria-controls="fileInput-tab" aria-selected="false">文件上传
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="inputTabsContent">
                        <div class="tab-pane fade show active" id="textInput-tab" role="tabpanel"
                             aria-labelledby="text-tab">
                            <label for="textInput" class="form-label fw-bold">请输入要分析的文本：</label>
                            <textarea class="form-control mb-3" id="textInput" rows="4"
                                      placeholder="在此输入文本..."></textarea>
                            <div class="model-selection mb-3">
                                <label for="modelSelect" class="form-label fw-bold">选择分析模型：</label>
                                <select class="form-select" id="modelSelect">
                                    <option value="">加载中...</option>
                                </select>
                                <div class="form-text" id="modelDescription"></div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="fileInput-tab" role="tabpanel" aria-labelledby="file-tab">
                            <label for="fileInput" class="form-label fw-bold">上传文本文件（每行一个句子）：</label>
                            <div class="input-group mb-3">
                                <input type="file" class="form-control" id="fileInput" accept=".txt">
                                <button class="btn btn-outline-secondary" type="button" id="fileViewBtn" disabled>预览内容
                                </button>
                            </div>
                            <div class="file-info small text-muted mb-3" id="fileInfo"></div>
                            <div class="file-preview mb-3 d-none" id="filePreview">
                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>文件预览</span>
                                        <button type="button" class="btn-close" aria-label="Close"
                                                id="closePreview"></button>
                                    </div>
                                    <div class="card-body">
                                        <pre id="fileContent" class="file-content"></pre>
                                    </div>
                                </div>
                            </div>
                            <div class="model-selection mb-3">
                                <label for="fileModelSelect" class="form-label fw-bold">选择分析模型：</label>
                                <select class="form-select" id="fileModelSelect">
                                    <option value="">加载中...</option>
                                </select>
                                <div class="form-text" id="fileModelDescription"></div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button class="btn btn-primary btn-analyze" onclick="analyzeText()">开始分析</button>
                    </div>
                    <div id="errorMessage" class="error-message mt-3"></div>
                </div>
            </div>
        </div>

        <!-- 整体结果区域 -->
        <div class="content-section" id="overall-section">
            <div class="section-header">
                <h4>整体分析结果</h4>
            </div>
            <div class="section-body">
                <div id="overallResult" class="result-card show">
                    <div class="overall-sentiment">
                        <h5>情感倾向：<span id="overallSentiment" class="badge bg-primary"></span></h5>
                        <div class="progress">
                            <div id="overallPositive" class="progress-bar bg-success" role="progressbar"></div>
                            <div id="overallNegative" class="progress-bar bg-danger" role="progressbar"></div>
                        </div>
                        <div class="text-muted small">
                            积极：<span id="overallPositiveProb"></span>% |
                            消极：<span id="overallNegativeProb"></span>%
                        </div>
                    </div>
                </div>

                <!-- 添加模型指标到整体分析区域 -->
                <div id="modelMetrics" class="result-card show">
                    <h5 class="mb-3">模型评估指标</h5>
                    <div class="metrics-grid">
                        <div class="metric-item">
                            <div class="small text-muted">准确率</div>
                            <div class="h4 mb-0 text-primary"><span id="accuracy"></span>%</div>
                        </div>
                        <div class="metric-item">
                            <div class="small text-muted">F1分数</div>
                            <div class="h4 mb-0 text-success"><span id="f1Score"></span>%</div>
                        </div>
                        <div class="metric-item">
                            <div class="small text-muted">召回率</div>
                            <div class="h4 mb-0 text-info"><span id="recall"></span>%</div>
                        </div>
                    </div>
                    <div class="chart-wrapper mt-4">
                        <h5 class="text-center mb-3">混淆矩阵</h5>
                        <div id="confusionMatrixChart" class="chart"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 句子分析区域 -->
        <div class="content-section" id="sentences-section">
            <div class="section-header">
                <h4>句子分析结果</h4>
            </div>
            <div class="section-body">
                <div id="sentenceResults" class="result-card show">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('list')">列表视图</button>
                        <button class="tab-button" onclick="switchTab('chart')">图表视图</button>
                    </div>
                    <div id="listView">
                        <h4 class="mb-3">句子分析：<span class="badge bg-secondary" id="sentenceCount"></span></h4>

                        <div class="filter-controls">
                            <div class="filter-row">
                                <span class="filter-label">情感筛选：</span>
                                <div class="filter-buttons">
                                    <button class="filter-button active" data-sentiment="all">全部</button>
                                    <button class="filter-button" data-sentiment="positive">积极</button>
                                    <button class="filter-button" data-sentiment="negative">消极</button>
                                </div>
                            </div>
                            <div class="filter-row">
                                <span class="filter-label">显示模式：</span>
                                <div class="filter-buttons">
                                    <button class="filter-button active" data-display="normal">正常</button>
                                    <button class="filter-button" data-display="compact">紧凑</button>
                                    <button class="filter-button" data-display="expanded">展开</button>
                                </div>
                            </div>
                        </div>

                        <div id="sentenceList"></div>

                        <div id="pagination" class="mt-3">
                            <div class="pagination-controls">
                                <div class="per-page-control">
                                    <span>每页显示：</span>
                                    <select id="perPageSelect" class="form-select form-select-sm" style="width: auto">
                                        <option value="5" selected>5条</option>
                                        <option value="10">10条</option>
                                        <option value="20">20条</option>
                                        <option value="50">50条</option>
                                    </select>
                                </div>
                                <div class="page-info" id="pageInfo"></div>
                            </div>

                            <div class="page-numbers" id="pageNumbers"></div>

                            <nav>
                                <ul class="pagination">
                                    <li class="page-item">
                                        <a class="page-link" href="#" onclick="changePage(-1)">上一页</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#" onclick="changePage(1)">下一页</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <div id="chartView" style="display: none;">
                        <!-- 修改为更灵活的布局结构 -->
                        <div class="charts-grid-layout">
                            <div class="chart-wrapper chart-wide">
                                <div id="sentimentPieChart" class="chart"></div>
                            </div>
                            <div class="chart-wrapper">
                                <div id="sentimentBarChart" class="chart"></div>
                            </div>
                            <div class="chart-wrapper">
                                <div id="sentimentScatterChart" class="chart"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 词频统计区域 -->
        <div class="content-section" id="word-freq-section">
            <div class="section-header">
                <h4>词频统计</h4>
            </div>
            <div class="section-body">
                <!-- 词频标签区域 - 保留这部分 -->
                <div id="wordFreq" class="result-card show">
                    <!-- 添加标签切换按钮 -->
                    <div class="tab-buttons">
                        <button class="tab-button active" data-view="tags">标签视图</button>
                        <button class="tab-button" data-view="chart">图表视图</button>
                    </div>
                    
                    <div id="wordFreqTags">
                        <h5 class="mb-3">词频标签云</h5>
                        <div id="wordFreqTagsContent" class="mt-3"></div>
                    </div>
                    
                    <!-- 添加词频图表容器 -->
                    <div id="wordFreqCharts" style="display:none;">
                        <div class="chart-wrapper">
                            <div id="wordFreqBarChart" class="chart" style="width:100%; height:400px;"></div>
                        </div>
                        <div class="chart-wrapper">
                            <div id="wordCloudChart" class="chart" style="width:100%; height:400px;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- 词频图表区域 - 已删除 -->
            </div>
        </div>

        <!-- 管理员区域 -->
        <div class="content-section admin-only" id="admin-section">
            <div class="section-header">
                <h4>系统管理</h4>
            </div>
            <div class="section-body">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>用户管理</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" id="createUserBtn">
                            <i class="bi bi-person-plus"></i> 创建新用户
                        </button>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>角色</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="5" class="text-center">加载中...</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 模型训练区域 -->
        <div class="content-section" id="training-section">
            <div class="section-header">
                <h4>模型训练</h4>
            </div>
            <div class="section-body">
                <form id="trainingForm">
                    <div class="card mb-4">
                        <div class="card-header bg-light d-flex align-items-center">
                            <i class="bi bi-gear-fill me-2 text-primary"></i>
                            <h5 class="mb-0">模型参数配置</h5>
                        </div>
                        <div class="card-body">
                            <!-- 模型类型选择区 - 卡片式 -->
                            <div class="param-group mb-4">
                                <div class="param-group-title">
                                    <i class="bi bi-cpu"></i> 选择模型类型
                                </div>
                                
                                <div class="model-type-selector">
                                    <div class="model-type-card" data-model="cnn">
                                        <input type="radio" name="modelType" id="modelCNN" value="cnn" checked>
                                        <div class="model-icon">
                                            <i class="bi bi-grid-3x3"></i>
                                        </div>
                                        <div class="model-name">TextCNN</div>
                                        <div class="model-description">卷积神经网络，适合捕捉局部特征</div>
                                        <div class="model-check"><i class="bi bi-check"></i></div>
                                    </div>
                                    
                                    <div class="model-type-card" data-model="lstm">
                                        <input type="radio" name="modelType" id="modelLSTM" value="lstm">
                                        <div class="model-icon">
                                            <i class="bi bi-arrow-left-right"></i>
                                        </div>
                                        <div class="model-name">LSTM</div>
                                        <div class="model-description">长短期记忆网络，适合序列数据</div>
                                        <div class="model-check"><i class="bi bi-check"></i></div>
                                    </div>
                                    
                                    <div class="model-type-card" data-model="lstm_attention">
                                        <input type="radio" name="modelType" id="modelLSTMAttn" value="lstm_attention">
                                        <div class="model-icon">
                                            <i class="bi bi-eye"></i>
                                        </div>
                                        <div class="model-name">LSTM+Attention</div>
                                        <div class="model-description">带注意力机制的LSTM</div>
                                        <div class="model-check"><i class="bi bi-check"></i></div>
                                    </div>
                                    
                                    <div class="model-type-card" data-model="bilstm">
                                        <input type="radio" name="modelType" id="modelBiLSTM" value="bilstm">
                                        <div class="model-icon">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </div>
                                        <div class="model-name">Bi-LSTM</div>
                                        <div class="model-description">双向LSTM，捕捉双向上下文</div>
                                        <div class="model-check"><i class="bi bi-check"></i></div>
                                    </div>
                                    
                                    <div class="model-type-card" data-model="bilstm_attention">
                                        <input type="radio" name="modelType" id="modelBiLSTMAttn" value="bilstm_attention">
                                        <div class="model-icon">
                                            <i class="bi bi-arrows-fullscreen"></i>
                                        </div>
                                        <div class="model-name">Bi-LSTM+Attention</div>
                                        <div class="model-description">双向LSTM加注意力机制</div>
                                        <div class="model-check"><i class="bi bi-check"></i></div>
                                    </div>
                                </div>
                                
                                <!-- 隐藏的真实选择器 -->
                                <select class="form-select d-none" id="modelTypeSelect">
                                    <option value="cnn" selected>TextCNN</option>
                                    <option value="lstm">LSTM</option>
                                    <option value="lstm_attention">LSTM+Attention</option>
                                    <option value="bilstm">Bi-LSTM</option>
                                    <option value="bilstm_attention">Bi-LSTM+Attention</option>
                                </select>
                            </div>
                            
                            <!-- 基础参数分组 -->
                            <div class="param-group">
                                <div class="param-group-title">
                                    <i class="bi bi-sliders"></i> 基础训练参数
                                </div>
                                
                                <!-- 两列布局的参数配置 -->
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="param-label-enhanced">
                                            <i class="bi bi-collection"></i> 批量大小
                                        </div>
                                        <select class="form-select" id="batchSizeSelect" required>
                                            <option value="32">32</option>
                                            <option value="64">64</option>
                                            <option value="128">128</option>
                                            <option value="256" selected>256</option>
                                        </select>
                                        <div class="param-help">一次训练的样本数量，影响训练速度和内存使用</div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="param-label-enhanced important-param">
                                            <i class="bi bi-repeat"></i> 训练轮数
                                        </div>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-repeat"></i></span>
                                            <input type="number" class="form-control" id="epochsInput" min="1" max="100" value="10" required>
                                        </div>
                                        <div class="param-help">完整训练数据集的次数</div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="param-label-enhanced">
                                            <i class="bi bi-gear"></i> 优化器
                                        </div>
                                        <select class="form-select" id="optimizerSelect">
                                            <option value="adam" selected>Adam</option>
                                            <option value="sgd">SGD</option>
                                            <option value="rmsprop">RMSprop</option>
                                        </select>
                                        <div class="param-help">参数优化算法，控制模型学习方式</div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="param-label-enhanced">
                                            <i class="bi bi-droplet"></i> Dropout比率
                                        </div>
                                        <div class="parameter-slider">
                                            <div class="slider-container">
                                                <input type="range" class="form-range" id="dropoutRange" min="0" max="8" value="5">
                                                <div class="value-display" id="dropoutDisplay">0.5</div>
                                            </div>
                                        </div>
                                        <input type="hidden" id="dropoutInput" value="0.5">
                                        <div class="param-help">防止过拟合的正则化参数 (0.1-0.9)</div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="param-label-enhanced">
                                            <i class="bi bi-scissors"></i> 权重衰减
                                        </div>
                                        <select class="form-select" id="weightDecaySelect">
                                            <option value="0.00001">1e-5</option>
                                            <option value="0.0001" selected>1e-4</option>
                                            <option value="0.001">1e-3</option>
                                            <option value="0.01">1e-2</option>
                                            <option value="0.1">1e-1</option>
                                        </select>
                                        <div class="param-help">L2正则化参数，控制模型复杂度</div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="form-check form-switch mt-4 ms-2">
                                            <input class="form-check-input" type="checkbox" id="earlyStopping">
                                            <label class="form-check-label fw-bold" for="earlyStopping">
                                                <i class="bi bi-clock-history me-2"></i>
                                                启用早停机制
                                            </label>
                                            <div class="param-help">当验证集表现不再提升时停止训练</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 早停设置 -->
                                <div id="earlyStoppingOptions" style="display:none;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="param-label-enhanced">
                                                <i class="bi bi-hourglass-split"></i> 早停耐心值
                                            </div>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-hourglass-split"></i></span>
                                                <input type="number" class="form-control" id="patienceInput" min="1" max="20" value="3">
                                            </div>
                                            <div class="param-help">验证集准确率在几轮内没有提高则停止训练</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- LSTM特有参数 -->
                            <div class="param-group lstm-only enhanced-param-container">
                                <div class="param-section-title">
                                    <i class="bi bi-braces"></i> LSTM特有参数
                                </div>
                                
                                <div class="param-tip tip-info">
                                    <i class="bi bi-info-circle"></i>
                                    <div>LSTM能有效捕获序列中的长距离依赖关系，特别适合处理文本等序列数据。</div>
                                </div>
                            
                                <div class="lstm-param-grid">
                                    <div class="model-param-card">
                                        <div class="model-param-header">
                                            <div class="model-param-icon">
                                                <i class="bi bi-layers"></i>
                                            </div>
                                            <div>
                                                <h5 class="model-param-title">隐藏层维度</h5>
                                                <p class="model-param-subtitle">影响模型复杂度和表达能力</p>
                                            </div>
                                        </div>
                                        
                                        <select class="form-select" id="hiddenDimSelect">
                                            <option value="64">64维</option>
                                            <option value="128" selected>128维 <span class="param-badge recommended">推荐</span></option>
                                            <option value="256">256维</option>
                                        </select>
                                        
                                        <div class="dimension-indicator">
                                            <div>
                                                <small>隐藏状态向量维度</small>
                                            </div>
                                            <span class="badge">128维向量</span>
                                        </div>
                                        
                                        <div class="param-impact">
                                            <div class="impact-grid">
                                                <div class="impact-item">
                                                    <div class="impact-label">表达能力</div>
                                                    <div class="impact-value impact-medium">中等</div>
                                                </div>
                                                <div class="impact-item">
                                                    <div class="impact-label">过拟合风险</div>
                                                    <div class="impact-value impact-medium">中等</div>
                                                </div>
                                                <div class="impact-item">
                                                    <div class="impact-label">训练时间</div>
                                                    <div class="impact-value impact-medium">中等</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="model-param-card">
                                        <div class="model-param-header">
                                            <div class="model-param-icon">
                                                <i class="bi bi-stack"></i>
                                            </div>
                                            <div>
                                                <h5 class="model-param-title">LSTM层数</h5>
                                                <p class="model-param-subtitle">增加模型深度和复杂度</p>
                                            </div>
                                        </div>
                                        
                                        <select class="form-select" id="numLayersSelect">
                                            <option value="1">单层</option>
                                            <option value="2" selected>双层 <span class="param-badge recommended">推荐</span></option>
                                            <option value="3">三层</option>
                                        </select>
                                        
                                        <div class="dimension-indicator">
                                            <div>
                                                <small>网络深度</small>
                                            </div>
                                            <span class="badge">2层LSTM</span>
                                        </div>
                                        
                                        <div class="param-impact">
                                            <div class="impact-grid">
                                                <div class="impact-item">
                                                    <div class="impact-label">层次特征</div>
                                                    <div class="impact-value impact-medium">中等</div>
                                                </div>
                                                <div class="impact-item">
                                                    <div class="impact-label">过拟合风险</div>
                                                    <div class="impact-value impact-medium">中等</div>
                                                </div>
                                                <div class="impact-item">
                                                    <div class="impact-label">训练时间</div>
                                                    <div class="impact-value impact-high">较长</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="param-tip tip-warning">
                                    <i class="bi bi-lightbulb-fill"></i>
                                    <div>增加隐藏层维度和层数可提高模型表达能力，但也会增加过拟合风险和训练时间。</div>
                                </div>
                            </div>
                            
                            <!-- CNN特有参数 -->
                            <div class="param-group cnn-only enhanced-param-container">
                                <div class="param-section-title">
                                    <i class="bi bi-grid-3x3"></i> CNN特有参数
                                </div>
                                
                                <div class="param-tip tip-info">
                                    <i class="bi bi-info-circle"></i>
                                    <div>TextCNN使用多尺寸卷积核并行提取特征，能有效捕获局部语义信息。</div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-lg-6 mb-3">
                                        <div class="model-param-card">
                                            <div class="model-param-header">
                                                <div class="model-param-icon">
                                                    <i class="bi bi-filter-square"></i>
                                                </div>
                                                <div>
                                                    <h5 class="model-param-title">卷积核数量</h5>
                                                    <p class="model-param-subtitle">每种尺寸使用的卷积核数量</p>
                                                </div>
                                            </div>
                                            
                                            <select class="form-select" id="numFiltersSelect">
                                                <option value="64">64个</option>
                                                <option value="128" selected>128个 <span class="param-badge recommended">推荐</span></option>
                                                <option value="256">256个</option>
                                            </select>
                                            
                                            <div class="dimension-indicator">
                                                <div><small>每种卷积核尺寸的过滤器数量</small></div>
                                                <span class="badge">128个卷积核</span>
                                            </div>
                                            
                                            <div class="param-impact">
                                                <div class="impact-grid">
                                                    <div class="impact-item">
                                                        <div class="impact-label">特征提取</div>
                                                        <div class="impact-value impact-medium">中等</div>
                                                    </div>
                                                    <div class="impact-item">
                                                        <div class="impact-label">过拟合风险</div>
                                                        <div class="impact-value impact-medium">中等</div>
                                                    </div>
                                                    <div class="impact-item">
                                                        <div class="impact-label">训练时间</div>
                                                        <div class="impact-value impact-medium">中等</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-6 mb-3">
                                        <div class="model-param-card">
                                            <div class="model-param-header">
                                                <div class="model-param-icon">
                                                    <i class="bi bi-aspect-ratio"></i>
                                                </div>
                                                <div>
                                                    <h5 class="model-param-title">卷积核尺寸</h5>
                                                    <p class="model-param-subtitle">捕获不同长度的文本特征</p>
                                                </div>
                                            </div>
                                            
                                            <div class="kernel-size-container">
                                                <div class="kernel-size-selector">
                                                    <div class="kernel-option">
                                                        <input class="kernel-checkbox" type="checkbox" id="kernelSize2" value="2" checked>
                                                        <label for="kernelSize2">
                                                            <span class="kernel-size">2</span>
                                                            <span class="kernel-desc">短语特征</span>
                                                        </label>
                                                    </div>
                                                    <div class="kernel-option">
                                                        <input class="kernel-checkbox" type="checkbox" id="kernelSize3" value="3" checked>
                                                        <label for="kernelSize3">
                                                            <span class="kernel-size">3</span>
                                                            <span class="kernel-desc">三元组</span>
                                                        </label>
                                                    </div>
                                                    <div class="kernel-option">
                                                        <input class="kernel-checkbox" type="checkbox" id="kernelSize4" value="4" checked>
                                                        <label for="kernelSize4">
                                                            <span class="kernel-size">4</span>
                                                            <span class="kernel-desc">短句特征</span>
                                                        </label>
                                                    </div>
                                                    <div class="kernel-option">
                                                        <input class="kernel-checkbox" type="checkbox" id="kernelSize5" value="5" checked>
                                                        <label for="kernelSize5">
                                                            <span class="kernel-size">5</span>
                                                            <span class="kernel-desc">长句特征</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="param-tip tip-success mt-3">
                                                <i class="bi bi-lightbulb"></i>
                                                <div>推荐选择多种尺寸组合，以捕获不同长度的文本特征</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="param-visual">
                                    <div class="cnn-visual">
                                        <div class="cnn-kernel">
                                            <div class="cnn-kernel-grid" style="--kernel-size: 2;">
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                            </div>
                                            <div class="cnn-kernel-label">2-gram</div>
                                        </div>
                                        <div class="cnn-kernel">
                                            <div class="cnn-kernel-grid" style="--kernel-size: 3;">
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                            </div>
                                            <div class="cnn-kernel-label">3-gram</div>
                                        </div>
                                        <div class="cnn-kernel">
                                            <div class="cnn-kernel-grid" style="--kernel-size: 4;">
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                                <div class="cnn-kernel-cell"></div>
                                            </div>
                                            <div class="cnn-kernel-label">4-gram</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer d-flex justify-content-center">
                            <button type="button" class="btn btn-primary training-action-btn" id="startTrainingBtn">
                                <i class="bi bi-play-fill"></i> 开始训练
                            </button>
                        </div>
                    </div>
                </form>

                <!-- 训练进度区域 -->
                <div id="trainingProgress" class="mt-4 d-none">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center bg-light">
                            <h5 class="mb-0 d-flex align-items-center">
                                <i class="bi bi-activity me-2 text-primary"></i>
                                训练进度
                            </h5>
                            <span id="trainingStatus" class="training-status-badge bg-primary">训练中</span>
                        </div>
                        <div class="card-body">
                            <div class="training-metrics">
                                <div class="metric-card">
                                    <div class="metric-label">当前轮次</div>
                                    <div class="metric-value" id="currentEpoch">0/0</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">预计剩余</div>
                                    <div class="metric-value" id="remainingTime">计算中...</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">完成进度</div>
                                    <div class="metric-value" id="progressPercentage">0%</div>
                                </div>
                            </div>

                            <div class="enhanced-progress-bar">
                                <div class="bar" id="progressBar" style="width: 0%"></div>
                                    <div class="progress-label" id="progressLabel">0%</div>
                                </div>
                            </div>

                            <div id="trainingControls" class="d-flex justify-content-center gap-3 mb-4 mt-3">
                                <button type="button" class="btn btn-warning training-action-btn" id="pauseTrainingBtn"></button>
                                    <i class="bi bi-pause-fill"></i> 暂停
                                </button>
                                <button type="button" class="btn btn-danger training-action-btn" id="stopTrainingBtn">
                                    <i class="bi bi-stop-fill"></i> 停止
                                </button>
                                <button type="button" class="btn btn-success training-action-btn" id="saveModelBtn" disabled>
                                    <i class="bi bi-download"></i> 保存模型
                                </button>
                            </div>

                            <!-- 改进的图表区域 -->
                            <div class="charts-container">
                                <div class="chart-container">
                                    <div class="chart-title">损失曲线</div>
                                    <div id="lossChart" style="width:100%; height:300px;"></div>
                                </div>
                                <div class="chart-container">
                                    <div class="chart-title">准确率曲线</div>
                                    <div id="accuracyChart" style="width:100%; height:300px;"></div>
                                </div>
                            </div>

                            <!-- 训练日志 -->
                            <div class="card mt-4"></div>
                                <div class="card-header bg-light d-flex align-items-center">
                                    <i class="bi bi-terminal me-2 text-primary"></i>
                                    训练日志
                                </div>
                                <div class="card-body p-0">
                                    <div class="training-log" id="trainingLog">
                                        <div class="log-content"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 模型评估结果 -->
                <div id="modelEvaluation" class="mt-4 d-none">
                    <div class="card evaluation-card">
                        <div class="card-header bg-light d-flex align-items-center">
                            <i class="bi bi-graph-up me-2 text-success"></i>
                            <h5 class="mb-0">模型评估</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-md-3 col-sm-6">
                                    <div class="evaluation-metric">
                                        <div class="eval-metric-label">准确率</div>
                                        <div class="eval-metric-value text-primary" id="testAccuracy">-</div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6">
                                    <div class="evaluation-metric">
                                        <div class="eval-metric-label">F1分数</div>
                                        <div class="eval-metric-value text-success" id="f1Score">-</div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6">
                                    <div class="evaluation-metric">
                                        <div class="eval-metric-label">召回率</div>
                                        <div class="eval-metric-value text-info" id="recall">-</div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6">
                                    <div class="evaluation-metric">
                                        <div class="eval-metric-label">精确率</div>
                                        <div class="eval-metric-value text-warning" id="precision">-</div>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-container mt-4">
                                <div class="chart-title">混淆矩阵</div>
                                <div id="confusionMatrix" style="height: 300px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 占位符 -->
                <div id="trainingPlaceholder" class="text-center py-5">
                    <div class="placeholder-icon">
                        <i class="bi bi-cpu" style="font-size: 3.5rem; color: #6c757d; opacity: 0.6;"></i>
                    </div>
                    <h5 class="mt-4 mb-3 text-secondary">准备训练您的模型</h5>
                    <p class="text-muted px-4">
                        在上方选择适合您的模型类型和参数，然后点击"开始训练"按钮启动训练过程
                    </p>
                </div>

                <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<div id="loading" class="loading">
    <div class="spinner-border text-primary" role="status"></div>
        <span class="visually-hidden">分析中...</span>
    </div>
    <p class="mb-0 mt-2">正在分析中<span id="loadingDots">...</span></p>
</div>

<!-- 创建用户模态框 -->
<div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createUserModalLabel">创建新用户</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="createUserForm">
                    <!-- 表单内容在JavaScript中动态生成 -->
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="saveUserBtn">创建用户</button>
            </div>
        </div>
    </div>
</div>

<!-- 编辑用户模态框 -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">编辑用户</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <input type="hidden" id="editOriginalData">
                    <div class="mb-3">
                        <label for="editUsername" class="form-label">用户名</label>
                        <input type="text" class="form-control" id="editUsername" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editEmail" class="form-label">电子邮箱</label>
                        <input type="email" class="form-control" id="editEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="editPassword" class="form-label">新密码（留空表示不修改）</label>
                        <input type="password" class="form-control" id="editPassword">
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="editIsAdmin">
                        <label class="form-check-label" for="editIsAdmin">管理员权限</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="updateUserBtn">更新用户</button>
            </div>
        </div>
    </div>
</div>

<!-- 删除确认模态框 -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">确认删除</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>确定要删除用户吗？此操作可以通过撤销按钮恢复。</p>
                <input type="hidden" id="deleteUserId">
                <input type="hidden" id="deleteUserData">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">删除</button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts-wordcloud@2.1.0/dist/echarts-wordcloud.min.js"></script>
<script src="/static/js/shared.js"></script>
<script src="/static/js/auth.js"></script>
<script src="/static/js/admin.js"></script>
<script src="/static/js/charts.js"></script>
<script src="/static/js/ui.js"></script>
<script src="/static/js/pagination.js"></script>
<script src="/static/js/fileupload.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/training.js"></script>
</body>
</html>