<div class="content-section" id="training-section">
    <div class="section-header">
        <h4>模型训练</h4>
    </div>
    <div class="section-body">
        <form id="trainingForm">
            <div class="card">
                <div class="card-header bg-light">
                    <h5 class="mb-0">模型参数配置</h5>
                </div>
                <div class="card-body">
                    <!-- 模型类型和批量大小 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="modelTypeSelect" class="form-label fw-bold">模型类型</label>
                            <select class="form-select" id="modelTypeSelect" required>
                                <option value="cnn" selected>TextCNN</option>
                                <option value="lstm">LSTM</option>
                                <option value="lstm_attention">LSTM+Attention</option>
                                <option value="bilstm">Bi-LSTM</option>
                                <option value="bilstm_attention">Bi-LSTM+Attention</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="batchSizeSelect" class="form-label fw-bold">批量大小</label>
                            <select class="form-select" id="batchSizeSelect" required>
                                <option value="32">32</option>
                                <option value="64">64</option>
                                <option value="128">128</option>
                                <option value="256" selected>256</option>
                            </select>
                        </div>
                    </div>

                    <!-- 训练轮数 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="epochsInput" class="form-label fw-bold">训练轮数</label>
                            <input type="number" class="form-control" id="epochsInput" min="1" max="100"
                                   value="10" required>
                        </div>
                        <div class="col-md-6">
                            <label for="optimizerSelect" class="form-label fw-bold">优化器</label>
                            <select class="form-select" id="optimizerSelect">
                                <option value="adam" selected>Adam</option>
                                <option value="sgd">SGD</option>
                                <option value="rmsprop">RMSprop</option>
                            </select>
                        </div>
                    </div>

                    <!-- Dropout和权重衰减 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="dropoutInput" class="form-label fw-bold">Dropout比率</label>
                            <input type="number" class="form-control" id="dropoutInput" min="0.1" max="0.9"
                                   step="0.1" value="0.5" required>
                        </div>
                        <div class="col-md-6">
                            <label for="weightDecaySelect" class="form-label fw-bold">权重衰减</label>
                            <select class="form-select" id="weightDecaySelect">
                                <option value="0.00001">1e-5 (0.00001)</option>
                                <option value="0.0001" selected>1e-4 (0.0001)</option>
                                <option value="0.001">1e-3 (0.001)</option>
                                <option value="0.01">1e-2 (0.01)</option>
                                <option value="0.1">1e-1 (0.1)</option>
                            </select>
                        </div>
                    </div>

                    <!-- 早停设置 -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="earlyStopping">
                                <label class="form-check-label" for="earlyStopping">
                                    启用早停机制
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3" id="earlyStoppingOptions" style="display:none;">
                        <div class="col-md-6">
                            <label for="patienceInput" class="form-label fw-bold">早停耐心值</label>
                            <input type="number" class="form-control" id="patienceInput" min="1" max="20"
                                   value="3">
                            <small class="form-text text-muted">验证集准确率在几轮内没有提高则停止训练</small>
                        </div>
                    </div>

                    <!-- LSTM特有参数 -->
                    <div class="row mb-3 lstm-only">
                        <div class="col-md-6">
                            <label for="hiddenDimSelect" class="form-label fw-bold">隐藏层维度</label>
                            <select class="form-select" id="hiddenDimSelect">
                                <option value="64">64</option>
                                <option value="128" selected>128</option>
                                <option value="256">256</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="numLayersSelect" class="form-label fw-bold">LSTM层数</label>
                            <select class="form-select" id="numLayersSelect">
                                <option value="1">1</option>
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                            </select>
                        </div>
                    </div>

                    <!-- Bidirectional LSTM特有参数 -->
                    <div class="row mb-3 bilstm-only" style="display:none;">
                        <div class="col-md-6">
                            <label for="mergeModeSelect" class="form-label fw-bold">方向合并方式</label>
                            <select class="form-select" id="mergeModeSelect">
                                <option value="concat" selected>拼接(concat)</option>
                                <option value="sum">求和(sum)</option>
                                <option value="mul">相乘(mul)</option>
                                <option value="avg">平均(avg)</option>
                            </select>
                        </div>
                    </div>

                    <!-- CNN特有参数 -->
                    <div class="row mb-3 cnn-only">
                        <div class="col-md-6">
                            <label for="numFiltersSelect" class="form-label fw-bold">卷积核数量</label>
                            <select class="form-select" id="numFiltersSelect">
                                <option value="64">64</option>
                                <option value="128" selected>128</option>
                                <option value="256">256</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="kernelSizeSelect" class="form-label fw-bold">卷积核大小</label>
                            <div class="d-flex">
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="2" id="kernelSize2" checked>
                                    <label class="form-check-label" for="kernelSize2">2</label>
                                </div>
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="3" id="kernelSize3" checked>
                                    <label class="form-check-label" for="kernelSize3">3</label>
                                </div>
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" value="4" id="kernelSize4" checked>
                                    <label class="form-check-label" for="kernelSize4">4</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="5" id="kernelSize5" checked>
                                    <label class="form-check-label" for="kernelSize5">5</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="card-footer text-center">
                    <button type="button" class="btn btn-primary" id="startTrainingBtn">
                        <i class="bi bi-play-fill"></i> 开始训练
                    </button>
                </div>
            </div>
        </form>

        <!-- 训练进度区域 -->
        <div id="trainingProgress" class="mt-4 d-none">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center bg-light">
                    <h5 class="mb-0">训练进度</h5>
                    <span id="trainingStatus" class="badge bg-primary">训练中</span>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6 mb-3">
                            <div class="data-item">
                                <div class="label text-muted">当前轮次</div>
                                <div class="value" id="currentEpoch">0/0</div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="data-item">
                                <div class="label text-muted">预计剩余</div>
                                <div class="value" id="remainingTime">计算中...</div>
                            </div>
                        </div>
                    </div>

                    <div class="progress mb-4" style="height: 20px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                                style="width: 0%" id="totalProgressBar" aria-valuenow="0"
                                aria-valuemin="0" aria-valuemax="100">0%
                        </div>
                    </div>

                    <div id="trainingControls" class="d-flex justify-content-center gap-3 mb-3">
                        <button type="button" class="btn btn-warning" id="pauseTrainingBtn">
                            <i class="bi bi-pause-fill"></i> 暂停
                        </button>
                        <button type="button" class="btn btn-danger" id="stopTrainingBtn">
                            <i class="bi bi-stop-fill"></i> 停止
                        </button>
                        <button type="button" class="btn btn-success" id="saveModelBtn" disabled>
                            <i class="bi bi-download"></i> 保存模型
                        </button>
                    </div>

                    <!-- 修改图表区域，确保容器结构和尺寸 -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="mb-3">
                                <h5 class="text-center">训练指标曲线</h5>
                            </div>
                            <div class="charts-row">
                                <div class="chart-item">
                                    <div class="chart-card">
                                        <div class="chart-header">损失曲线</div>
                                        <div class="chart-body">
                                            <!-- 添加内联样式确保图表容器可见 -->
                                            <div id="lossChart"
                                                    style="width:100%; height:300px; min-height:300px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="chart-item">
                                    <div class="chart-card">
                                        <div class="chart-header">准确率曲线</div>
                                        <div class="chart-body">
                                            <!-- 添加内联样式确保图表容器可见 -->
                                            <div id="accuracyChart"
                                                    style="width:100%; height:300px; min-height:300px;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 训练日志 -->
                    <div class="card mt-4" id="trainingLog">
                        <div class="card-header bg-light">训练日志</div>
                        <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                            <div class="log-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 模型评估结果 -->
        <div id="modelEvaluation" class="mt-4 d-none">
            <div class="card">
                <div class="card-header">
                    <h5 class="m-0">模型评估</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">准确率</h6>
                                    <h3 id="testAccuracy" class="text-primary">-</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">F1分数</h6>
                                    <h3 id="f1Score" class="text-success">-</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">召回率</h6>
                                    <h3 id="recall" class="text-info">-</h3>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">精确率</h6>
                                    <h3 id="precision" class="text-warning">-</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">混淆矩阵</div>
                                <div class="card-body">
                                    <div id="confusionMatrix" style="height: 300px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- 占位符 -->
        <div id="trainingPlaceholder" class="text-center py-5">
            <i class="bi bi-cpu" style="font-size: 3rem; color: #ccc;"></i>
            <p class="mt-3 text-muted">选择模型参数并点击"开始训练"按钮开始训练模型</p>
        </div>

        <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;"></div>
    </div>
</div>
